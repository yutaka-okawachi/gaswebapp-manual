<!DOCTYPE html>
<html>

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZT6MPW5MNG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-ZT6MPW5MNG');
    </script>
    <meta charset="UTF-8">
    <!-- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨èªã‹ã‚‰æ¤œç´¢ (RW)</title>
    <link rel="stylesheet" href="css/common.css">
    <script src="js/app.js?v=8"></script>

    <script>
        /*******************************************************************
         * ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆç”¨èªã‹ã‚‰æ¤œç´¢ãƒšãƒ¼ã‚¸ - RWï¼‰
         ******************************************************************/

        // debounce(é˜²æŒ¯)ç”¨ã®é–¢æ•°
        function debounce(func, delay) {
            let timer;
            return function (...args) {
                clearTimeout(timer);
                timer = setTimeout(() => func.apply(this, args), delay);
            };
        }

        let currentSearchId = 0;
        let termEntries = []; // { original, normalized } ã®é…åˆ—ã‚’ä¿æŒ

        // Helper to normalize string (Inlined for robustness)
        function normalizeString(str) {
            if (!str) return '';
            return str.toLowerCase()
                .replace(/Ã¤/g, 'ae')
                .replace(/Ã¶/g, 'oe')
                .replace(/Ã¼/g, 'ue')
                .replace(/ÃŸ/g, 'ss')
                .trim();
        }

        // Ensure focusResultsPanel exists
        if (typeof window.focusResultsPanel !== 'function') {
            window.focusResultsPanel = function(options) {
                const resultsDiv = document.getElementById('results');
                if (!resultsDiv) return;
                const topOffset = Math.max((resultsDiv.getBoundingClientRect().top + window.scrollY) - 20, 0);
                const behavior = options && options.instant ? 'auto' : 'smooth';
                window.scrollTo({ top: topOffset, behavior });
            };
        }

        // DOMæ§‹ç¯‰å¾Œã«å‹•ä½œã‚’ã‚»ãƒƒãƒˆ
        window.addEventListener('DOMContentLoaded', async () => {
            const inputField = document.getElementById('termInput');
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æ–‡å­—ã‚’å…¥åŠ›ã™ã‚‹ãŸã³ã«ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
            inputField.addEventListener('input', debouncedOnTermInput);

            // Load data locally
            if (typeof loadData === 'function') {
                await loadData('richard_wagner');
            }

            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å…¨ç”¨èªãƒªã‚¹ãƒˆã‚’å–å¾—
            if (typeof getGenericTermsListLocal === 'function') {
                termEntries = getGenericTermsListLocal('richard_wagner');
                console.log(`Loaded ${termEntries.length} terms locally for RW.`);
            } else {
                console.error('getGenericTermsListLocal is missing');
            }
        });

        // å…¥åŠ›ãŒã‚ã£ãŸã‚‰300mså¾Œã«ã‚µã‚¸ã‚§ã‚¹ãƒˆæ¤œç´¢ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°
        const debouncedOnTermInput = debounce((event) => {
            const input = event.target.value.trim();
            if (input.length < 2) {
                // 2æ–‡å­—æœªæº€ãªã‚‰ã‚µã‚¸ã‚§ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
                document.getElementById('termSuggestions').innerHTML = '';
                return;
            }

            const normalizedInput = normalizeString(input);
            const matches = termEntries
                .filter(entry => entry.normalized.includes(normalizedInput))
                .sort((a, b) => {
                    // å‰æ–¹ä¸€è‡´ã‚’å„ªå…ˆ
                    const aStarts = a.normalized.startsWith(normalizedInput);
                    const bStarts = b.normalized.startsWith(normalizedInput);
                    if (aStarts && !bStarts) return -1;
                    if (!aStarts && bStarts) return 1;
                    return a.normalized.localeCompare(b.normalized);
                })
                .slice(0, 50); // å€™è£œæ•°ã‚’50ä»¶ã«åˆ¶é™

            updateDatalist(matches);

        }, 300);

        // datalist ã«å€™è£œã‚’è¡¨ç¤ºã™ã‚‹
        function updateDatalist(suggestions) {
            const datalist = document.getElementById('termSuggestions');
            datalist.innerHTML = '';
            suggestions.forEach(entry => {
                const option = document.createElement('option');
                option.value = entry.normalized; // æ­£è¦åŒ–ã•ã‚ŒãŸå€¤ã‚’ä½¿ç”¨
                option.textContent = entry.original; // è¡¨ç¤ºã¯å…ƒã®å½¢å¼
                datalist.appendChild(option);
            });
        }

        // ã€Œæ¤œç´¢ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
        function search() {
            const query = document.getElementById('termInput').value.trim();
            const resultsDiv = document.getElementById('results');
            const loadingHtml = '<p class="loading">æ¤œç´¢ä¸­ãƒ»ãƒ»ãƒ»</p>';
            resultsDiv.innerHTML = loadingHtml;
            if (typeof focusResultsPanel === 'function') {
                focusResultsPanel({ instant: true });
            }

            // ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯
            if (!query) {
                resultsDiv.innerHTML = '<p class="result-message">æ¤œç´¢èªå¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>';
                if (typeof focusResultsPanel === 'function') {
                    focusResultsPanel({ instant: true });
                }
                return;
            }

            currentSearchId++;
            const thisSearchId = currentSearchId;

            // Execute search (Local)
            setTimeout(() => {
                if (thisSearchId !== currentSearchId) return;
                
                try {
                    let html = '';
                    if (typeof searchRWTermsLocal === 'function') {
                        html = searchRWTermsLocal(query);
                    } else {
                        html = '<div class="result-message">æ¤œç´¢æ©Ÿèƒ½ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (searchRWTermsLocal missing)</div>';
                    }
                    resultsDiv.innerHTML = html;
                } catch (e) {
                    console.error(e);
                    resultsDiv.innerHTML = `<div class="result-message" style="color:red;">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${e.message}<br>${e.stack}</div>`;
                }
                
                if (typeof focusResultsPanel === 'function') {
                    focusResultsPanel({ instant: true });
                }

                // Send notification
                if (typeof sendSearchNotification === 'function') {
                    const details = {
                        work: 'All (RW)',
                        scope: 'Term',
                        term: query
                    };
                    sendSearchNotification(details, 'rw_terms_search.html');
                }
            }, 10);
        }

        function cancelSearch() {
            currentSearchId++;
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p class="result-message">æ¤œç´¢ã‚’ä¸­æ­¢ã—ã¾ã—ãŸã€‚</p>';
        }

        function clearInput() {
            document.getElementById('termInput').value = '';
            document.getElementById('termSuggestions').innerHTML = '';
            document.getElementById('results').innerHTML = '';
            document.getElementById('termInput').focus();
        }
    </script>
</head>

<body>
    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="sidebar" id="sidebar">
        <h3 class="sidebar-home"><a href="home.html">ğŸ  HOME</a></h3>

        <h3>Richard Wagner (RW)</h3>
        <ul>
            <li><a href="richard_wagner.html">æ›²åã‹ã‚‰æ¤œç´¢</a></li>
            <li><a href="rw_terms_search.html">ç”¨èªã‹ã‚‰æ¤œç´¢</a></li>
        </ul>

        <h3>Gustav Mahler (GM)</h3>
        <ul>
            <li><a href="index.html">æ›²åã¨æ¥½å™¨ç­‰ã‹ã‚‰æ¤œç´¢</a></li>
            <li><a href="terms_search.html">ç”¨èªã‹ã‚‰æ¤œç´¢</a></li>
        </ul>

        <h3>Richard Strauss (RS)</h3>
        <ul>
            <li><a href="richard_strauss.html">æ›²åã‹ã‚‰æ¤œç´¢</a></li>
            <li><a href="rs_terms_search.html">ç”¨èªã‹ã‚‰æ¤œç´¢</a></li>
        </ul>

        <h3>ç”¨èªé›†</h3>
        <ul>
            <li><a href="dic.html">ç”¨èªé›†ãƒšãƒ¼ã‚¸</a></li>
        </ul>

        <h3 class="sidebar-other"><a href="other.html" style="color: inherit; text-decoration: none;">ãã®ä»–</a></h3>
        <ul>
            <!-- ä»¥å‰ã®é …ç›®ã¯ other.html ã¸ç§»å‹• -->
        </ul>
    </nav>

    <div class="page-wrapper">
        <div class="container">
            <div class="home-link"><a href="home.html">HOME</a></div>
            <h1>ç”¨èªã‹ã‚‰æ¤œç´¢ (RW)</h1>
        <p style="text-align: center;"><span style="font-size: 0.9rem;">å„ç”¨èªã«ã¤ã„ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆã¯</span><a href="dic.html" target="_blank" style="font-size: 1.2rem; font-weight: bold; color: var(--button-bg); text-decoration: none; border-bottom: 2px solid transparent; transition: all 0.2s ease;">ç”¨èªé›†</a><span style="font-size: 0.9rem;">ã‚’å‚ç…§</span></p>
        <div style="background-color: #f5f5f5; border-radius: 8px; padding: 15px 20px; margin-bottom: 20px;">
            <p style="margin-top: 0;">
                æ¤œç´¢ã¯è‹±å­—å…¥åŠ›ãªã®ã§ï¼Œç‰¹æ®Šæ–‡å­—ã®å…¥åŠ›ã¯æ…£ä¾‹ã«ã—ãŸãŒã†<br>
            <ul style="margin-bottom: 0;">
                <li>Ã¤â‡’aeã€€ä¾‹ï¼šDÃ¤mpferâ‡’Daempfer</li>
                <li>Ã¼â‡’ueã€€ä¾‹ï¼šzurÃ¼ckhaltenâ‡’zurueckhalten</li>
                <li>Ã¶â‡’oeã€€ä¾‹ï¼šFlÃ¶teâ‡’Floete</li>
                <li>ÃŸâ‡’ssã€€ä¾‹ï¼šflieÃŸendâ‡’fliessend</li>
            </ul>
            </p>
        </div>

        <!-- æ¤œç´¢å…¥åŠ›æ¬„ -->
        <input type="text" id="termInput" list="termSuggestions" placeholder="æ¤œç´¢ã™ã‚‹ç”¨èªã‚’å…¥åŠ›">
        <datalist id="termSuggestions"></datalist>

        <!-- ãƒœã‚¿ãƒ³é¡ -->
        <div style="text-align: center;">
            <button type="button" onclick="search()" class="btn-search">æ¤œç´¢</button>
            <button type="button" onclick="cancelSearch()" class="btn-danger">ä¸­æ­¢</button>
            <button type="button" onclick="clearInput()" class="clear-input-btn">å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢</button>
        </div>

        <!-- çµæœè¡¨ç¤ºæ  -->
        <div id="results"></div>

        <!-- ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
        <div id="scrollToTop" onclick="scrollToTop()">â–² ãƒšãƒ¼ã‚¸ã®ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</div>
    </div>
        </div>
    </div>
</body>

</html>